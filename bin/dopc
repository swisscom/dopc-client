#!/usr/bin/env ruby

require 'gli'
require 'rest-client'
require 'json'

include GLI::App

program_desc 'CLI client for DOPc'

version Dopc::VERSION

subcommand_option_handling :normal
arguments :strict

desc 'URL where DOPc service runs'
default_value 'http://localhost:3000'
arg_name 'url'
flag [:u,:url]

desc 'API version to use'
default_value '1'
arg_name 'api'
flag [:a,:api]

desc 'Ping the API'
command :ping do |c|
  c.action do |global_options,options,args|
    r = RestClient.get "#{global_options[:url]}/api/v#{global_options[:api]}/ping", {accept: :json}
    j = JSON.parse(r.body)
    puts j['text']
  end
end

exit run(ARGV)
